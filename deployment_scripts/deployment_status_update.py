#!/usr/bin/env python3
"""Send comprehensive deployment status update"""

import requests
from datetime import datetime

SLACK_WEBHOOK = "https://hooks.slack.com/services/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"

def send_update():
    blocks = [
        {
            "type": "header",
            "text": {"type": "plain_text", "text": "üìä Deployment Status Update"}
        },
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": f"*Time:* {datetime.now().strftime('%Y-%m-%d %H:%M:%S UTC')}"
            }
        },
        {"type": "divider"},
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*üê≥ Backend Status:*\n‚Ä¢ Current: v3.1.171 (redeployed but same version)\n‚Ä¢ Ready: v3.1.173 pushed to Docker Hub\n‚Ä¢ Issue: Render appears to be caching the :latest tag\n\n**Solution:** Change Render's Docker image setting from `:latest` to `:v3.1.173` specifically"
            }
        },
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*üåê Frontend Status:*\n‚Ä¢ MyRoofGenius: ‚ùå 500 error - Likely missing env vars in Vercel:\n  - `NEXT_PUBLIC_SUPABASE_URL`\n  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`\n  - `SUPABASE_SERVICE_ROLE_KEY`\n  - `NEXTAUTH_SECRET`\n‚Ä¢ BrainStackStudio: ‚úÖ Ready to deploy (pushed to GitHub)"
            }
        },
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*ü§ñ AUREA Status:*\n‚Ä¢ Core: ‚úÖ Operational\n‚Ä¢ Chat: ‚úÖ Working (requires auth)\n‚Ä¢ Voice: ‚úÖ Synthesis endpoint ready\n‚Ä¢ Executive: ‚úÖ Features operational\n‚Ä¢ UI: ‚è≥ Frontend integration needed"
            }
        },
        {"type": "divider"},
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*‚ö° Actions Needed:*\n1. **Render:** Change Docker image to `mwwoodworth/brainops-backend:v3.1.173`\n2. **Vercel (MyRoofGenius):** Add missing Supabase env vars\n3. **Vercel (BrainStackStudio):** Connect GitHub repo for deployment\n4. **Slack:** Configure Event Subscriptions once MyRoofGenius is fixed"
            }
        },
        {
            "type": "context",
            "elements": [
                {
                    "type": "mrkdwn",
                    "text": "üí° v3.1.173 includes complete Slack integration and all AI services"
                }
            ]
        }
    ]
    
    payload = {
        "text": "Deployment Status Update",
        "blocks": blocks,
        "username": "ClaudeOS",
        "icon_emoji": "üìä"
    }
    
    requests.post(SLACK_WEBHOOK, json=payload)
    print("‚úÖ Status update sent")

if __name__ == "__main__":
    send_update()